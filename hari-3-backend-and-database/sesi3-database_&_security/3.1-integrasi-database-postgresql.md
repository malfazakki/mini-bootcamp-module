# Materi 3.1: Menghubungkan ke Database (PostgreSQL)

## ðŸ—„ï¸ Kenapa Pakai Database?
Sebelumnya, kita menyimpan data di dalam **Array**. Masalahnya: jika server dimatikan atau di-restart, datanya **hilang**. 
**Database** menyimpan data di dalam harddisk sehingga permanen.

---

## ï¿½ Persiapan: Instalasi PostgreSQL

Sebelum menghubungkan Node.js, pastikan kamu sudah menginstall database PostgreSQL di komputer kamu.

1.  **Download Installer:**
    *   Buka website resmi: [postgresql.org/download](https://www.postgresql.org/download/)
    *   Pilih sistem operasi kamu (Windows/macOS).
    *   Download versi terbaru yang stabil.

2.  **Proses Instalasi:**
    *   Jalankan installer yang sudah didownload.
    *   Ikuti langkah-langkahnya (Next, Next).
    *   **PENTING:** Saat diminta memasukkan **password** untuk user `postgres`, **ingat baik-baik password ini!** Kamu akan membutuhkannya nanti di kode koneksi.
    *   Biarkan port default di `5432`.

3.  **Cek Instalasi:**
    *   Buka aplikasi **pgAdmin 4** (biasanya ikut terinstall) atau terminal.
    *   Jika menggunakan terminal, ketik `psql --version` untuk memastikan sudah terinstall.

---

## ï¿½ðŸ› ï¸ Langkah Integrasi (Node.js + PostgreSQL)

Untuk menghubungkan Node.js dengan PostgreSQL, kita butuh asisten bernama library `pg`.

### 1. Install Library
Di terminal, ketik:
```bash
npm install pg
```

### 2. Kode Koneksi Database
Buat file `db.js` atau tambahkan di atas `server.js`:

```javascript
const { Client } = require('pg');

// Informasi alamat database (Contoh)
const client = new Client({
  host: 'localhost',
  user: 'postgres',
  password: 'password_kamu',
  database: 'latihan_db',
  port: 5432,
});

client.connect()
  .then(() => console.log('Terhubung ke Database!'))
  .catch(err => console.error('Gagal konek:', err));

module.exports = client;
```

---

## ðŸ§± Membuat Tabel "pengeluaran"

Sebelum melakukan query di kode, buat tabel untuk menyimpan data pengeluaran. Jalankan perintah SQL berikut di pgAdmin (Query Tool) atau terminal `psql`:

```sql
CREATE TABLE IF NOT EXISTS pengeluaran (
  id SERIAL PRIMARY KEY,
  nama TEXT NOT NULL,
  nominal INTEGER NOT NULL
);
```

---

## ðŸ” Mengambil Data dari Database

Sekarang, ubah kode `app.get` kamu agar mengambil data dari tabel, bukan dari array:

```javascript
const express = require("express");
const client = require("./db");
const app = express();
app.use(express.json());

const port = 3000;

// Read (Mengirim data pengeluaran)
app.get("/pengeluaran", async (req, res) => {
	try {
		const result = await client.query("SELECT * FROM pengeluaran");
		res.json(result.rows);
	} catch {
		res.status(500).json("Internal server error");
	}
});

// Create (Menambah data pengeluaran)
app.post("/pengeluaran", async (req, res) => {
	try {
		const { nama, nominal } = req.body;

		await client.query("INSERT INTO pengeluaran (nama, nominal) VALUES ($1, $2) RETURNING *", [nama, nominal]);

		res.json("Data Pengeluaran berhasil ditambahkan");
	} catch {
		res.status(500).json("Internal server error");
	}
});

// Update (Mengubah data pengeluaran)
app.put("/pengeluaran/:id", async (req, res) => {
	try {
		const idUbah = parseInt(req.params.id);
		const { nama, nominal } = req.body;

		const result = await client.query("UPDATE pengeluaran SET nama = $1, nominal = $2 WHERE id = $3", [
			nama,
			nominal,
			idUbah,
		]);

		if (result.rowCount > 0) {
			res.json(`Data dengan ID:${idUbah} berhasil diubah`);
		} else {
			res.status(404).json("Data tidak ditemukan");
		}
	} catch {
		res.status(500).json("Internal server error");
	}
});

// Delete (Menghapus data pengeluaran)
app.delete("/pengeluaran/:id", async (req, res) => {
	try {
		const idHapus = parseInt(req.params.id);

		const result = await client.query("DELETE FROM pengeluaran WHERE id = $1", [idHapus]);

		if (result.rowCount > 0) {
			res.json(`Data ID: ${idHapus} berhasil dihapus`);
		} else {
			res.status(404).json("Data tidak ditemukan");
		}
	} catch (err) {
		res.status(500).json("Internal server error");
	}
});

app.listen(port, () => {
	console.log(`Server berjalan di localhost:${port}`);
});
```

**ðŸŽ“ Setelah Sesi Ini, Kamu Sudah Bisa:**
- âœ… Menghubungkan Server Node.js ke PostgreSQL.
- âœ… Melakukan perintah SQL `SELECT` lewat kode JavaScript.
- âœ… Menyimpan data secara permanen di database.
