# Materi 1.2: Fetch API

## üåê Apa itu Fetch API?

**Fetch API** adalah cara modern JavaScript untuk melakukan **HTTP requests** dari browser ke server.

**üí° Sebelum Fetch:**
Pakai `XMLHttpRequest` (ribet & complicated)

**‚úÖ Dengan Fetch:**
Clean, modern, pakai Promises/async-await

---

## üìù Sintaks Dasar Fetch

```javascript
fetch(url, options)
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error(error));
```

**Parameters:**
- **`url`**: Endpoint API yang dituju
- **`options`**: Object berisi method, headers, body (opsional)

---

## üîç GET Request (Ambil Data)

### **Contoh 1: GET Sederhana**

```javascript
fetch('https://jsonplaceholder.typicode.com/posts')
    .then(response => response.json())
    .then(data => {
        console.log(data);  // Array of posts
    })
    .catch(error => {
        console.error('Error:', error);
    });
```

---

### **Contoh 2: GET dengan Async/Await** ‚≠ê RECOMMENDED

```javascript
async function getPosts() {
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts');
        
        // Cek status
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log(data);
        
    } catch (error) {
        console.error('Error:', error);
    }
}

getPosts();
```

---

### **Contoh 3: GET Single Item**

```javascript
async function getPost(id) {
    try {
        const response = await fetch(`https://jsonplaceholder.typicode.com/posts/${id}`);
        
        if (!response.ok) {
            throw new Error('Post not found');
        }
        
        const post = await response.json();
        console.log(post);
        
    } catch (error) {
        console.error('Error:', error);
    }
}

getPost(1);
```

---

## ‚ûï POST Request (Kirim Data)

```javascript
async function createPost() {
    try {
        const newPost = {
            title: 'Belajar Fetch API',
            body: 'Fetch API sangat mudah digunakan!',
            userId: 1
        };
        
        const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(newPost)
        });
        
        if (!response.ok) {
            throw new Error('Failed to create post');
        }
        
        const data = await response.json();
        console.log('Created:', data);
        
    } catch (error) {
        console.error('Error:', error);
    }
}

createPost();
```

**üí° Penting:**
- **`method: 'POST'`** ‚Üí Tentukan HTTP method
- **`Content-Type: 'application/json'`** ‚Üí Server tahu data berbentuk JSON
- **`JSON.stringify()`** ‚Üí Ubah object JavaScript jadi string JSON

---

## üìù PUT Request (Update Full)

```javascript
async function updatePost(id) {
    try {
        const updatedPost = {
            id: id,
            title: 'Updated Title',
            body: 'Updated body content',
            userId: 1
        };
        
        const response = await fetch(`https://jsonplaceholder.typicode.com/posts/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedPost)
        });
        
        const data = await response.json();
        console.log('Updated:', data);
        
    } catch (error) {
        console.error('Error:', error);
    }
}

updatePost(1);
```

---

## üîß PATCH Request (Update Partial)

```javascript
async function patchPost(id) {
    try {
        const response = await fetch(`https://jsonplaceholder.typicode.com/posts/${id}`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                title: 'Only Update Title'  // Hanya update title
            })
        });
        
        const data = await response.json();
        console.log('Patched:', data);
        
    } catch (error) {
        console.error('Error:', error);
    }
}

patchPost(1);
```

---

## üóëÔ∏è DELETE Request

```javascript
async function deletePost(id) {
    try {
        const response = await fetch(`https://jsonplaceholder.typicode.com/posts/${id}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            console.log('Post deleted successfully');
        } else {
            throw new Error('Failed to delete');
        }
        
    } catch (error) {
        console.error('Error:', error);
    }
}

deletePost(1);
```

---

## üéØ Response Methods

### **response.json()**
Parse response sebagai JSON.

```javascript
const data = await response.json();
```

### **response.text()**
Parse response sebagai plain text.

```javascript
const text = await response.text();
```

### **response.ok**
Boolean: `true` jika status 200-299, `false` jika error.

```javascript
if (response.ok) {
    // Success!
}
```

### **response.status**
HTTP status code (200, 404, 500, dll).

```javascript
console.log(response.status);  // 200
```

### **response.headers**
Response headers.

```javascript
console.log(response.headers.get('Content-Type'));
```

---

## üé® Contoh Lengkap: Todo App dengan Fetch

```html
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Fetch API Demo</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 50px auto; }
        input, button { padding: 10px; margin: 5px; }
        .todo { padding: 10px; background: #f0f0f0; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Todo App (Fetch API Demo)</h1>
    
    <div>
        <input type="text" id="todoInput" placeholder="New todo...">
        <button onclick="addTodo()">Add</button>
    </div>
    
    <div id="todoList"></div>
    
    <script>
        const API_URL = 'http://localhost:3000/api/todos';
        
        // Load todos saat page load
        window.addEventListener('DOMContentLoaded', loadTodos);
        
        async function loadTodos() {
            try {
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch todos');
                }
                
                const result = await response.json();
                const todos = result.data;
                
                renderTodos(todos);
                
            } catch (error) {
                console.error('Error loading todos:', error);
                document.getElementById('todoList').innerHTML = 
                    `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        async function addTodo() {
            const input = document.getElementById('todoInput');
            const title = input.value.trim();
            
            if (!title) {
                alert('Please enter a todo');
                return;
            }
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to create todo');
                }
                
                const result = await response.json();
                console.log('Created:', result);
                
                // Clear input
                input.value = '';
                
                // Reload todos
                loadTodos();
                
            } catch (error) {
                console.error('Error creating todo:', error);
                alert('Error: ' + error.message);
            }
        }
        
        async function deleteTodo(id) {
            if (!confirm('Delete this todo?')) return;
            
            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('Failed to delete todo');
                }
                
                console.log('Deleted todo:', id);
                
                // Reload todos
                loadTodos();
                
            } catch (error) {
                console.error('Error deleting todo:', error);
                alert('Error: ' + error.message);
            }
        }
        
        function renderTodos(todos) {
            const container = document.getElementById('todoList');
            
            if (todos.length === 0) {
                container.innerHTML = '<p>No todos yet!</p>';
                return;
            }
            
            container.innerHTML = todos.map(todo => `
                <div class="todo">
                    <span>${todo.title}</span>
                    <button onclick="deleteTodo(${todo.id})">Delete</button>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
```

---

## üîê Headers & Authentication

### **Custom Headers**

```javascript
const response = await fetch(url, {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer YOUR_TOKEN_HERE',
        'X-Custom-Header': 'CustomValue'
    }
});
```

### **Authentication dengan Token**

```javascript
async function getProtectedData() {
    const token = localStorage.getItem('authToken');
    
    const response = await fetch('http://localhost:3000/api/protected', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    });
    
    const data = await response.json();
    return data;
}
```

---

## üéØ Query Parameters

```javascript
// Cara 1: Manual string concatenation
const url = `https://api.example.com/search?q=javascript&limit=10`;

// Cara 2: URLSearchParams (RECOMMENDED)
const params = new URLSearchParams({
    q: 'javascript',
    limit: 10,
    page: 1
});

const url = `https://api.example.com/search?${params}`;
fetch(url);
```

---

## ‚è±Ô∏è Timeout & AbortController

### **Timeout Request**

```javascript
async function fetchWithTimeout(url, timeout = 5000) {
    const controller = new AbortController();
    const signal = controller.signal;
    
    const timeoutId = setTimeout(() => controller.abort(), timeout);
    
    try {
        const response = await fetch(url, { signal });
        clearTimeout(timeoutId);
        return await response.json();
    } catch (error) {
        if (error.name === 'AbortError') {
            console.error('Request timeout!');
        }
        throw error;
    }
}

// Usage
fetchWithTimeout('https://api.example.com/slow-endpoint', 3000)
    .then(data => console.log(data))
    .catch(error => console.error(error));
```

---

## üé® Error Handling Best Practices

```javascript
async function apiRequest(url, options = {}) {
    try {
        const response = await fetch(url, options);
        
        // Cek HTTP status
        if (!response.ok) {
            // Parse error dari server jika ada
            const errorData = await response.json();
            throw new Error(errorData.message || `HTTP ${response.status}`);
        }
        
        // Parse response
        const data = await response.json();
        return { success: true, data };
        
    } catch (error) {
        // Network error atau error lainnya
        console.error('API Request Error:', error);
        return {
            success: false,
            error: error.message
        };
    }
}

// Usage
const result = await apiRequest('http://localhost:3000/api/users');
if (result.success) {
    console.log('Users:', result.data);
} else {
    console.error('Error:', result.error);
}
```

---

## ‚úÖ Checklist Fetch API

- [ ] Gunakan **async/await** (lebih clean dari .then())
- [ ] **Cek `response.ok`** sebelum parse
- [ ] **Try-catch** untuk error handling
- [ ] **Gunakan headers** yang tepat (`Content-Type`, dll)
- [ ] **JSON.stringify()** untuk POST/PUT body
- [ ] **Loading state** untuk UX yang baik
- [ ] **Error messages** yang user-friendly

---

## üéØ Yang Harus Dikuasai:

- ‚úÖ Sintaks Fetch dengan async/await
- ‚úÖ GET, POST, PUT, PATCH, DELETE requests
- ‚úÖ Headers & Content-Type
- ‚úÖ response.ok & response.status
- ‚úÖ Error handling
- ‚úÖ Query parameters
- ‚úÖ Authentication headers
- ‚úÖ Timeout & AbortController

---

**üí° Tips:**
- **Selalu cek `response.ok`** sebelum `.json()`
- **Try-catch** untuk semua fetch requests
- **Console.log** response untuk debugging
- **Test di Postman dulu** sebelum implement di frontend
- Gunakan **Environment Variables** untuk base URL
- Tambahkan **loading indicators** saat fetch data üöÄ

**üéä Next:** Kita akan deploy aplikasi ke production!
